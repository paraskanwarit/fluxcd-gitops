# GitOps Change Workflow - Detailed Process

```mermaid
sequenceDiagram
    participant Dev as Developer
    participant ChartRepo as github.com/paraskanwarit/<br/>sample-app-helm-chart
    participant GitOpsRepo as flux-app-delivery<br/>(Local Repository)
    participant SourceCtrl as Flux Source Controller<br/>(flux-system namespace)
    participant HelmCtrl as Flux Helm Controller<br/>(flux-system namespace)
    participant K8s as Kubernetes API<br/>(GKE Cluster)
    participant App as sample-app2 Deployment<br/>(sample-app namespace)

    Note over Dev,App: Scenario 1: Update Application Image Version
    
    Dev->>ChartRepo: 1. Edit charts/sample-app/values.yaml<br/>Change: image.tag "1.21" â†’ "1.22"
    Dev->>ChartRepo: 2. git commit & push to main branch
    
    Note over SourceCtrl: Every 1 minute interval check
    
    SourceCtrl->>ChartRepo: 3. Poll repository for changes<br/>(GitRepository: sample-app-helm-chart)
    ChartRepo-->>SourceCtrl: 4. New commit detected
    SourceCtrl->>SourceCtrl: 5. Download & cache new chart version
    
    HelmCtrl->>SourceCtrl: 6. Check for chart updates<br/>(HelmRelease: sample-app2)
    SourceCtrl-->>HelmCtrl: 7. New chart content available
    
    HelmCtrl->>HelmCtrl: 8. Generate Helm upgrade plan<br/>Compare current vs desired state
    HelmCtrl->>K8s: 9. Apply Helm upgrade<br/>kubectl apply updated manifests
    
    K8s->>App: 10. Rolling update deployment<br/>Create new pods with nginx:1.22
    App->>App: 11. Terminate old pods<br/>nginx:1.21 pods gracefully shutdown
    
    Note over Dev,App: Scenario 2: Override via GitOps Repository
    
    Dev->>GitOpsRepo: 12. Edit helmrelease/sample-app-helmrelease.yaml<br/>Add values override:<br/>replicaCount: 3
    Dev->>GitOpsRepo: 13. git add, commit, push changes
    
    Note over SourceCtrl: Flux monitors GitOps repo too
    
    SourceCtrl->>GitOpsRepo: 14. Detect HelmRelease changes
    HelmCtrl->>HelmCtrl: 15. Process updated HelmRelease spec<br/>Merge chart values with overrides
    HelmCtrl->>K8s: 16. Apply Helm upgrade<br/>Scale deployment to 3 replicas
    
    K8s->>App: 17. Scale up deployment<br/>Create additional pods
    App-->>Dev: 18. Application now running<br/>3 replicas with nginx:1.22
```

## Exact File Paths and Objects

**Infrastructure Repository: gke-gitops-infra**
- `terraform-module/` - Reusable GKE Terraform module
- `environment/non-prod/dev/main.tf` - Creates cluster "demo-gke-cluster"
- `flux-bootstrap/main.tf` - Installs Flux with GitHub integration

**Application Repository: github.com/paraskanwarit/sample-app-helm-chart**
- `charts/sample-app/Chart.yaml` - Helm chart metadata (version 0.1.2)
- `charts/sample-app/values.yaml` - Default application configuration
- `charts/sample-app/templates/` - Kubernetes manifest templates

**GitOps Repository: flux-app-delivery**
- `helmrelease/sample-app-helmrepository.yaml` - GitRepository "sample-app-helm-chart"
- `helmrelease/sample-app-helmrelease.yaml` - HelmRelease "sample-app2"
- `namespaces/sample-app-namespace.yaml` - Namespace "sample-app"

**Kubernetes Objects Created:**
- Namespace: `sample-app`
- HelmRelease: `sample-app2` (in sample-app namespace)
- GitRepository: `sample-app-helm-chart` (in flux-system namespace)
- Deployment: Generated by Helm chart (nginx application)
- Service: Generated by Helm chart (exposes nginx)

## Demo Change Examples

**Change Image Tag:**
```yaml
# In sample-app-helm-chart/charts/sample-app/values.yaml
image:
  repository: nginx
  tag: "1.22"  # Changed from "1.21"
```

**Override Replicas:**
```yaml
# In flux-app-delivery/helmrelease/sample-app-helmrelease.yaml
spec:
  values:
    replicaCount: 3  # Override chart default of 1
```